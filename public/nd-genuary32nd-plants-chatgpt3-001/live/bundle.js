(()=>{"use strict";const e=(e,t,n,a=!0)=>a?Math.floor(e*(n-t+1)+t):e*(n-t)+t,t=(t,a,o,i,l=!0,s=!1,r=null,h=null)=>{const u=[];let d=0;for(let c=0;c<a;c++){d=0;let a=e(t.next(),o,i,l);if(null!==r&&(a=+a.toFixed(r)),s)for(;u.includes(a)||n(u,a,h);)if(a=e(t.next(),o,i,l),null!==r&&(a=+a.toFixed(r)),d++,d>50){d=0;break}u.push(a)}return u};function n(e,t,n,a=2){let o=!1;for(let i=0;i<e.length;i++){let l=e[i],s=Math.abs(l-t);if(s=+s.toFixed(a),s<=n){o=!0;break}}return o}const a=e=>{const{ranges:t,currentValue:n}=e;let a="";return t.every((e=>{const t=Object.keys(e)[0],o=e[t][0],i=e[t][1];return!(n>=o&&n<=i&&(a=t,1))})),a},o=new class{constructor(){}next(){return fxrand()}list({size:e,fillWith:t=null,unique:n=!1,precision:a=null}){const o=[];if(null===t)for(let t=0;t<e;t++){let e=this.next();if(null!==a&&(e=+e.toFixed(a)),n)for(;o.includes(e);)e=this.next(),e=+e.toFixed(a);o.push(e)}else for(let n=0;n<e;n++)o.push(t);return o}},i=new class{constructor({}){this.canvas=document.querySelector("canvas#nd-output"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.resizeCanvasToSquare(),window.addEventListener("resize",(()=>{this.resizeCanvasToSquare()})),window._downloadSource=this.canvas,document.addEventListener("keydown",(e=>{(e.isComposing||"KeyS"===e.code)&&window.downloadPreview()})),window.downloadPreview=()=>{let e=document.createElement("a");e.download=fxhash,e.href=window._downloadSource.toDataURL(),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}resizeCanvasToSquare(){const e=Math.min(window.innerWidth,window.innerHeight);this.canvas.width=e,this.canvas.height=e}}({}),{canvas:l,ctx:s}=i;!function({ctx:n,canvas:o,prng:i}){const l=2048;$fx.params([{id:"timeOfDay",name:"Time of Day",type:"select",default:"Sunny Noon",options:{options:["Sunny Noon","Rainbow Midnight"]}},{id:"plantsAmount",name:"Plants Amount",type:"number",options:{min:1,max:8,step:1}},{id:"flowerLightness",name:"Flower Lightness %",type:"number",default:60,options:{min:10,max:90,step:1}},{id:"backgroundSaturation",name:"Background Saturation %",type:"number",default:18,options:{min:10,max:30,step:1}}]),console.log($fx.getParams());let s=null,r=0,h=0,u=0,d=0;const c=function(e,t){let n=[],a=360*e;for(let e=0;e<14;e++)n.push(`hsl(${(a+360*e/14)%360}, 80%, 60%)`);return n}(i.next());let[p,m,x,g,f,w,M,S,y,A,R,b,v,T]=c;const F=$fx.getParam("backgroundSaturation");let P;const C=$fx.getParam("timeOfDay");let H;if(P="Sunny Noon"===C?e(i.next(),55,65):e(i.next(),26,30),T=_(T,F,P),b=_(b,F,P),R=_(R,F,P),v=_(v,F,P),"Rainbow Midnight"===C){H=function(e){let t=0;const n=[];for(let e=0;e<14;e++)n.push(`hsl(${t}, 100%, 50%)`),t+=25.714285714285715;return n}();for(let e=0;e<H.length;e++)H[e]=_(H[e],F,P)}const I=e(i.next(),350,500,!1),G=e(i.next(),0,1,!1),$=e(i.next(),.01,.1,!1);let L=[];const k=$fx.getParam("plantsAmount"),q=e(i.next(),2,4,!0),W=t(i,k,q,k+q,!0,!0),z=e(i.next(),.45,.65,!1),O=t(i,k,.35,z,!1,!0,2,.05),D={x:0,y:1,startTime:0,stemHeight:0,stemWidth:0,stemMaxHeight:0,stemGrowthSpeed:0,stemColor:A,leafSize:0,leafPosition:0,centerRadius:0,centerMaxRadius:0,centerColor:p,centerGrowthSpeed:0,centerRadiusFinal:0,petalAlpha:.75,petalColor:m,petalAmount:0,petalRadius:0,petalMaxRadius:0,petalAngle:0,petalGrowthSpeed:0,isSpecial:!1},N=function({amount:e}){const t=[],n=1/e;for(let a=1;a<=e;a++)t.push({x:a*n-n/2});return t}({amount:k});for(let e=0;e<k;e++)E({plants:L,y:1-$,x:N[e].x,petalAmount:W[e],petalAmountsMin:q,plantsAmount:k,stemMaxHeight:O[e],isFirst:0===e&&2!==k&&3!==k,isLast:e===k-1&&2!==k&&3!==k,isTheOne:1===k});function B(e){let t=e-r;if(r=e,t>68)s=requestAnimationFrame(B);else{n.clearRect(0,0,o.width,o.height),function({groundHeight:e=.05,colorGrass:t="lightgreen",colorSky:a="lightblue",colorGround:i="#8B4513",colors:l}){let s=n.createLinearGradient(0,o.height*(1-e),0,0);if(void 0!==l)for(let e=0;e<l.length;e++)s.addColorStop(e/(l.length-1),l[e]);else s.addColorStop(0,t),s.addColorStop(1,a);n.fillStyle=s,n.fillRect(0,0,o.width,o.height*(1.05-e)),n.fillStyle=i,n.fillRect(0,o.height*(1-e),o.width,o.height*e)}({colorGrass:R,colorGround:v,colorSky:b,groundHeight:$,colors:H}),function({x:e,y:t,radius:a,colorSun:i="yellow"}){const s=a/l*o.width;n.fillStyle=i,n.beginPath(),n.arc(e*o.width,t*o.height,s,0,2*Math.PI),n.fill()}({x:G,y:0,radius:I,colorSun:T}),n.globalAlpha=1;for(const a of L)e>=a.startTime&&(V(a,t),a.reachedMaxHeight&&(a.reachedMaxHeight=!0,n.globalAlpha=a.petalAlpha,Y(a,t),n.globalAlpha=1,U(a,t)));n.globalAlpha=1,s=requestAnimationFrame(B)}}function E({plants:t,plantsAmount:n,x:a,y:o,petalAmount:l,petalAmountsMin:s,stemMaxHeight:r,isFirst:h,isLast:u,isTheOne:d}){const c={...D},[y,R]=function(e){let t=e[Math.floor(i.next()*e.length)],n=e[Math.floor(i.next()*e.length)];for(;t===n;)n=e[Math.floor(i.next()*e.length)];return[n,t]}([p,m,x,g,f,w,M,S]);c.startTime=e(i.next(),0,2e3,!1),c.stemWidth=e(i.next(),20,25),c.stemMaxHeight=r,c.petalAmount=l,c.petalAmountThreshold=n+s;let b=2.5;if(h||u?!h&&!u||d?d&&(c.centerMaxRadius=e(i.next(),150,170),c.petalMaxRadius=e(i.next(),150,160),c.stemMaxHeight=e(i.next(),.4,z,!1),c.petalAmount=e(i.next(),s,n+s),c.petalAmountThreshold=100):(c.centerMaxRadius=e(i.next(),35,45),c.petalMaxRadius=e(i.next(),35,45),c.stemMaxHeight=e(i.next(),.2,.3,!1),b=1):(c.centerMaxRadius=e(i.next(),90,140),c.petalMaxRadius=e(i.next(),100,120),c.petalAmount=e(i.next(),s,n+s)),c.stemColor=_(A,e(i.next(),30,40),e(i.next(),40,50)),c.centerColor=_(y,e(i.next(),60,80),$fx.getParam("flowerLightness")),c.petalColor=_(R,e(i.next(),90,100),$fx.getParam("flowerLightness")),c.stemGrowthSpeed=e(i.next(),.1,.5,!1),c.centerGrowthSpeed=e(i.next(),.05,.075,!1),c.petalGrowthSpeed=e(i.next(),.0125,.025,!1),c.leafPosition=e(i.next(),.65,1,!1),c.leafSize=e(i.next(),c.stemWidth+20*b,c.stemWidth+50*b),c.petalAngle=e(i.next(),0,180)*Math.PI/180,c.operation="source-over",c.petalAmount>=c.petalAmountThreshold&&(c.operation="screen",c.isSpecial=!0),"Rainbow Midnight"===C){const t=Math.round(e(i.next(),0,1,!1));c.operation=0===t?"overlay":"difference",c.stemColor=_(c.stemColor,55,e(i.next(),10,20)),c.isSpecial=!0}c.y=o,c.x=a,t.push(c)}function V(e,t){n.fillStyle=e.stemColor||"rgba(255, 255, 255, .25)";let a=e.stemWidth/l*o.width,i=e.stemHeight/2048*o.height;n.fillRect(parseInt(e.x*o.width-a/2),e.y*o.height-i,parseInt(a),i);let s=e.y*o.height-i*(1-e.leafPosition),r=e.leafSize/l*o.width;n.beginPath(),n.moveTo(parseInt(e.x*o.width),s),n.lineTo(parseInt(e.x*o.width)-r,s-r/2),n.lineTo(parseInt(e.x*o.width)+r,s-r/2),n.fill(),i<2048*e.stemMaxHeight/l*o.height&&!e.reachedMaxHeight?e.stemHeight+=e.stemGrowthSpeed*t:e.reachedMaxHeight=!0,e.stemHeightFinal=i}function U(e,t){n.fillStyle=e.centerColor||"yellow";let a=e.centerRadius/l*o.width;n.beginPath(),n.arc(parseInt(e.x*o.width),parseInt(e.y*o.height)-e.stemHeightFinal,a,0,2*Math.PI),n.fill(),e.centerRadius<e.centerMaxRadius&&(e.centerRadius+=e.centerGrowthSpeed*t),e.centerRadiusFinal=a,n.globalCompositeOperation="source-over"}function Y(e,t){n.globalCompositeOperation=e.operation,n.fillStyle=e.petalColor||"pink",e.isSpecial&&(n.globalAlpha=1);let a=e.petalRadius/l*o.width;for(let t=0;t<e.petalAmount;t++)n.beginPath(),n.arc(parseInt(e.x*o.width)+(a+e.centerRadiusFinal/2)*Math.cos(e.petalAngle+t*Math.PI/(e.petalAmount/2)),parseInt(e.y*o.height)-e.stemHeightFinal+(a+e.centerRadiusFinal/2)*Math.sin(e.petalAngle+t*Math.PI/(e.petalAmount/2)),a,0,2*Math.PI),n.fill();e.petalRadius<e.petalMaxRadius&&(e.petalRadius+=e.petalGrowthSpeed*t),n.globalCompositeOperation="source-over"}function _(e,t,n){let[a,o,i]=e.match(/hsl\(\s*(\d+\.?\d*)\s*,\s*(\d+\.?\d*)%\s*,\s*(\d+\.?\d*)%\s*\)/).slice(1).map(Number);return void 0!==n&&(i=n),`hsl(${a}, ${t}%, ${i}%)`}function j(){h=e(i.next(),25,1e3,!0),u=e(i.next(),.05,50,!0),d=Math.floor(h*u),console.log(`redraw in ${d}ms`)}L.sort(((e,t)=>e.stemMaxHeight-t.stemMaxHeight)),s=requestAnimationFrame(B),console.log(fxhash),j(),function(e){const{plants:t,redrawInMs:n,plantsAmount:o,environment:i,flowerLightness:l}=e;let s=0;for(let e=0;e<t.length;e++)s+=t[e].isSpecial?1:0;const r=a({currentValue:n,ranges:[{Tarantula:[0,250]},{"It's a Trap":[250,1e3]},{Schwifty:[1e3,5e3]},{"This Is The Way":[5e3,15e3]},{"s'All Good Man":[15e3,2e4]},{"There's Always Money In The Banana Stand":[2e4,25e3]},{"You Turn Yourself Around, Thats What It's All About":[25e3,3e4]},{"Danger Zone":[3e4,4e4]},{"Go God Go":[4e4,42500]},{"What's My Age Again":[42500,5e4]},{"Say My Name":[5e4,55e3]},{"winter Is Coming":[55e3,59999]},{"We Have Done The Impossible And That Makes Us Mighty":[59999,6e4]}]}),h=a({currentValue:l,ranges:[{"Nightmare Moon":[10,30]},{"Twilight Sparkle":[30,50]},{Rarity:[50,70]},{"Princess Celestia":[70,90]}]});$fx.features({"Time of Day":i,"Plants Amount":o,"Special Plants Amount":s,"Flower Lightness":h,"First Redraw":r}),$fx.getFeatures()}({plants:L,redrawInMs:d,plantsAmount:k,environment:C,flowerLightness:$fx.getParam("flowerLightness")}),console.log("$fxhashFeatures",$fx.getFeatures()),$fx.isPreview?setTimeout((()=>{$fx.preview()}),51e3):setTimeout((function t(){window.cancelAnimationFrame(s);for(const t of L)t.reachedMaxHeight=!1,t.stemHeight=0,t.petalRadius=0,t.centerRadius=0,t.stemGrowthSpeed=e(i.next(),.1,.5,!1),t.centerGrowthSpeed=e(i.next(),.05,.075,!1),t.petalGrowthSpeed=e(i.next(),.0125,.025,!1);j(),s=requestAnimationFrame(B),setTimeout(t,d)}),d)}({ctx:s,canvas:l,prng:o});const r=()=>{window.requestAnimationFrame(r)};r()})();