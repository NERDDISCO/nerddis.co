<section class="full-height center">

  <div class="column space-around center--text">
    <p>
      <span class="icon" style="filter: invert(100%);">{{ "static/social/love.svg" | readFile | safeHTML }}</span>&nbsp;since 2014
    </p>
  </div>

  <div class="column space-around--all center--text">
    <p>
      <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> |
      <a href="legal">Legal</a>
    </p>
  </div>
</section>

<pwa-update-available class="update-available" hidden>
  <button class="update-available__button">Update available</button>
</pwa-update-available>

</body>
<script type="module" async>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      (async () => {
        const { PwaUpdateAvailable } = await import('./js/pwa-helper-components/pwa-update-available/PwaUpdateAvailable.js');
        customElements.define('pwa-update-available', PwaUpdateAvailable);

        navigator.serviceWorker.register('/sw.js');
      })();
    });
  }
</script>

<script type="module" async>
  const filters = document.querySelectorAll('.filter-option')

  const setQueryParameter = (params) => {
    const { type } = params;
    const url = new URL(window.location);
    url.searchParams.set('filter', type);
    window.history.pushState({}, '', url);
  }

  const changeActiveFilter = (params) => {
    let { type } = params
    let matchesToHide;
    let matchesToShow;

    // Block away wrong requests
    if (type === null) {
      type = 'all'
    }

    // Show all
    if (type === 'all') {
      matchesToShow = document.querySelectorAll(`.show[data-type]:not([data-type="all"])`)
    } else {
      matchesToHide = document.querySelectorAll(`.show[data-type]:not([data-type="${type}"])`)
      matchesToShow = document.querySelectorAll(`.show[data-type="${type}"]`)

      matchesToHide.forEach(match => {
        match.classList.add('hidden')
      })
    }

    // Valid for all types
    matchesToShow.forEach(match => {
      match.classList.remove('hidden')
    })

    // Highlight the current filter
    filters.forEach((filter) => {
      const _type = filter.dataset.type

      if (type === _type) {
        filter.classList.add('active')
      } else {
        filter.classList.remove('active')
      }
    })
  }

  const loadFromUrl = (params) => {
    const url = new URL(window.location);
    const type = url.searchParams.get('filter')

    changeActiveFilter({ type })
  }

  // When the page is loaded, set the correct filter
  loadFromUrl()
  // Overwrite the behavior of the filter links
  filters.forEach((filter) => {
    const type = filter.dataset.type

    filter.addEventListener("click", (e) => {
      e.preventDefault()
      changeActiveFilter({ type })
      setQueryParameter({ type })
    })
  })
</script>

</html>
